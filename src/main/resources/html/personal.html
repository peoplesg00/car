<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>豪车俱乐部</title>
    <link rel="stylesheet" type="text/css" href="../css/personal.css">
    <script type="text/javascript" src="../js/jquery-1.11.1.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
</head>

<body>
<div class="Navigation">
    <a href="index.html" class="btn btn-danger">首页</a>
    <a href="communication.html" class="btn btn-danger">交流之地</a>
    <a href="personal.html" class="btn btn-danger">个人车库</a>
</div>
<div class="Login">
    <a id="UserName" class="btn btn-danger"></a>
    <a id="login" href="login.html" class="btn btn-danger">
    </a>
    <a id="register" href="register.html" class="btn btn-danger">
    </a>
</div>
<hr style="width:1440px; background: white;clear: both;margin-left: 20px;">
<div id="context">
    <div class="left_information">
        <button id="SelectToCar" class="btn btn-danger">查看帖子</button>
        <button id="SelectToUser" class="btn btn-danger">个人信息</button>
        <button id="SelectToWord" class="btn btn-danger">查看留言</button>
        <button id="updatePassword" class="btn btn-danger">修改密码</button>
    </div>
    <div class="right_information" id="right_information">
        <div id="car_information">
            <div class='showImg'>
                <img id='Car_Img' src=''>
                <div class='showA' id="showA">
                    <button id="home_page" class="btn btn-default">首页</button>
                    <button id="previous_page" class="btn btn-default">上一页</button>
                    <button id="next_page" class="btn btn-default">下一页</button>
                    <button id="trailing_page" class="btn btn-default">尾页</button>
                    <a href='car.html' class="btn btn-default">增添</a>
                    <a id="delete" href="" class="btn btn-default">删除</a>
                </div>
            </div>
            <table class='Car_information' id="information">
                <tr>
                    <td><input type='text' name='id' id='id' size='40' disabled="disabled"
                               style='text-align: center;display: none;'></td>
                </tr>
                <tr>
                    <td><input type='text' name='name' id='name' size='40'></td>
                </tr>
                <tr>
                    <td><input type='text' name='power' id='power' size='40'></td>
                </tr>
                <tr>
                    <td><input type='text' name='price' id='price' size='40'></td>
                </tr>
                <tr>
                    <td><input type='text' name='date' id='date' size='40'></td>
                </tr>
                <tr>
                    <td><textarea name='description' id='description' rows="8" class="form-control"
                                  style="margin-top: 40px;"></textarea></td>
                </tr>
                <tr>
                    <td>
                        <label for="CarImg" class=" btn btn-default" style="margin-top: 10px;">更换图片</label>
                        <input id="CarImg" type="file" style="display:none">
                    </td>
                </tr>
                <tr>
                    <td><input id='Submit' style='margin-top: 10px; height: 30px; width: 50px;' type='submit' value='修改'
                               class="btn btn-info"></td>
                </tr>
            </table>
        </div>
        <div id="user_information" class="user_information">
            <!--头像-->
            <div class="form-group">
                <div>
                    <img id="userImg" src="">
                </div>
            </div>
            <!--ID-->
            <div class="form-group">
                <div>
                    <input id="userID" disabled="disabled" title="">
                </div>
            </div>
            <!--用户名称-->
            <div class="form-group">
                <div>
                    <input class="form-control" type="text" placeholder="用户名称" name="name" id="user">
                </div>
            </div>
            <!--电话号码-->
            <div class="form-group">
                <div>
                    <input class="form-control" type="text" placeholder="电话号码" name="phone" id="phone">
                </div>
            </div>
            <!--地址-->
            <div class="form-group">
                <div>
                    <input class="form-control" type="text" placeholder="地址" name="location" id="location">
                </div>
            </div>
            <!--图片-->
            <div class="form-group">
                <div>
                    <label for="img" class="form-control" style="width: 200px;margin-left: 400px;">更换头像</label>
                    <input type="file" name="img" id="img" style="display: none;">
                </div>
            </div>
            <div>
                <button id="update" type="submit" class="btn bg-primary">
                    提交修改
                </button>
            </div>
        </div>
        <div id="watch_word" style="display: none; width: 400px;margin: auto;">
            <form role='form'>
                <table class="table table-bordered">
                    <div>
                        <label for='messageID'>ID</label>
                        <input type='text' class='form-control' id='messageID' disabled='disabled'>
                    </div>
                    <div>
                        <label for='message'>留言者</label>
                        <input type='text' class='form-control' id='message' disabled='disabled'>
                    </div>
                    <div>
                        <label for='questionID'>问题帖子ID</label>
                        <input type='text' class='form-control' id='questionID' disabled='disabled'>
                    </div>
                    <div>
                        <label for='problem'>问题</label>
                        <input type='text' class='form-control' id='problem' disabled='disabled'>
                    </div>
                    <div>
                        <label for='progress'>问题进度</label>
                        <input type='text' class='form-control' id='progress' disabled='disabled'>
                    </div>
                    <div>
                        <label for='select'>现是否已解决问题</label>
                        <select id="select" class="form-control">
                            <option>完成</option>
                            <option>解决中</option>
                            <option>未完成</option>
                        </select>
                    </div>
                    <button type="button" class="btn btn-default" id="page_p"
                            style="margin-top: 10px; margin-left: 10px;">上一页
                    </button>
                    <button type="submit" class="btn btn-default" id="btn_submit"
                            style="margin-top: 10px; margin-left: 10px;">提交
                    </button>
                    <button type="button" class="btn btn-default" id="page_l"
                            style="margin-top: 10px; margin-left: 10px;">下一页
                    </button>
                </table>
            </form>
        </div>
        <div id="updateUserPassword" class="updateUserPassword">
            <table>
                <tbody>
                <tr>
                    <td><input type="text" id="secret" size="40" placeholder="请输入您的密保"></td>
                </tr>
                <tr>
                    <td><input type="password" id="password1" size="40" placeholder="请输入您的密码"></td>
                </tr>
                <tr>
                    <td><input type="password" id="password2" size="40" placeholder="请再次输入您的密码"></td>
                </tr>
                <tr>
                    <td><input type="button" id="updateToPassword" size="40" value="确定"></td>
                </tr>
                <tr>
                    <td><input type="reset" id="reset" size="40" value="取消"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</div>
<!--<hr style="width:1440px; background: white;clear: both;margin-left: 20px;">-->
</body>
<script type="text/javascript">
    $(document).ready(function () {
        var i = 0;
        var ID = 0;
        var name = sessionStorage.getItem("name");
        if (sessionStorage.getItem("name") != null && $.trim(sessionStorage.getItem("name")).length > 0) {
            $("#register").hide();
            $("#login").hide();
            $("#UserName").html("欢迎用户：" + name);
        } else {
            window.location.href = "login.html";
        }
        // 显示用户帖子信息
        $("#SelectToCar").on("click", function () {
            var upData = new FormData();
            upData.append("name", name);
            $.ajax({
                type: "POST",
                contentType: false,
                cache: false,
                processData: false,
                dataType: "json",
                url: "http://localhost:8083/car/selectByUserName",
                data: upData,
                xhrFields: {withCredentials: true},
                success: function (data) {
                    if ("success" === data.status) {
                        page(i);
                        $("#home_page").on('click', function () {
                            i = 0;
                            page(i);
                        });
                        $("#previous_page").on('click', function () {
                            if (i > 0) {
                                i--;
                                page(i);
                            } else {
                                alert("已经是第一页");
                            }
                        });
                        $("#next_page").on('click', function () {
                            if (i < data.data.length) {
                                i++;
                                page(i);
                            } else {
                                alert("已经是最后一页");
                            }
                        });
                        $("#trailing_page").on('click', function () {
                            i = data.data.length - 1;
                            page(i);
                        });

                        function page(i) {
                            var date = new Date(data.data[i].date).getFullYear() + "/" + new Date(data.data[i].date).getMonth() + "/" +
                                new Date(data.data[i].date).getDate();
                            ID = data.data[i].id;
                            $("#id").val(data.data[i].id);
                            $("#name").val(data.data[i].name);
                            $("#power").val(data.data[i].power);
                            $("#price").val(data.data[i].price);
                            $("#date").val(date);
                            $("#description").val(data.data[i].description);
                            $("#Car_Img").attr("src", "../picture/car/User_Car/" + data.data[i].vehicle + "");
                        }

                        $("#car_information").show();
                        $("#information").show();
                        $("#showA").show();
                        $("#user_information").hide();
                        $("#updateUserPassword").hide();
                        $("#watch_word").hide();
                    } else {
                        alert("信息获取失败，原因为：" + data.data.errMsg);
                    }
                },
                error: function () {
                    alert("暂无帖子");
                    window.setTimeout(window.location.href = "car.html", 2000);
                }
            });
        });
        //修改用户帖子信息
        $("#Submit").on("click", function () {
            var upData = new FormData();
            if ($("#name").val() != null) {
                upData.append("name", $("#name").val());
            }
            if ($("#power").val() != null) {
                upData.append("power", $("#power").val());
            }
            if ($("#price").val() != null) {
                upData.append("price", $("#price").val());
            }
            if ($("#date").val() != null) {
                upData.append("date", $("#date").val());
            }
            if ($("#description").val() != null) {
                upData.append("description", $("#description").val());
            }
            if ($("#CarImg")[0].files[0] != null) {
                upData.append("img", $("#CarImg")[0].files[0]);
            }
            upData.append("user_name", name);
            upData.append("id", $("#id").val());
            $.ajax({
                type: "POST",
                contentType: false,
                cache: false,
                processData: false,
                dataType: "json",
                url: "http://localhost:8083/car/updateToCar",
                data: upData,
                xhrFields: {withCredentials: true},
                success: function (data) {
                    if (data.status == "success") {
                        alert("修改成功");
                    }
                },
                error: function (data) {
                    if (data.status === 500) {
                        alert("参数获取不到，修改失败。")
                    } else {
                        alert("修改失败！" + data.responseText);
                    }
                }
            });
        });
        //显示用户信息
        $("#SelectToUser").on("click", function () {
            var upData = new FormData();
            upData.append("name", name);
            $.ajax({
                type: "POST",
                contentType: false,
                cache: false,
                processData: false,
                dataType: "json",
                url: "http://localhost:8083/user/selectByUserName",
                data: upData,
                xhrFields: {withCredentials: true},
                success: function (data) {
                    if (data.status === "success") {
                        for (var i = 0; i < data.data.length; i++) {
                            $("#user").val(data.data[i].name);
                            $("#userID").val(data.data[i].id);
                            $("#phone").val(data.data[i].phone);
                            $("#location").val(data.data[i].location);
                            $("#userImg").attr("src", "../picture/user/" + data.data[i].img);
                        }
                        $("#user_information").show();
                        $("#car_information").hide();
                        $("#updateUserPassword").hide();
                        $("#watch_word").hide();
                    }
                },
                error: function (data) {
                    alert("查看个人信息失败！" + data.responseText);
                }
            });
        });
        //显示用户留言
        $("#SelectToWord").on("click", function () {
            var upData = new FormData();
            upData.append("name", name);
            $.ajax({
                type: "POST",
                contentType: false,
                cache: false,
                processData: false,
                dataType: "json",
                url: "http://localhost:8083/word/selectByUserName",
                data: upData,
                xhrFields: {withCredentials: true},
                success: function (data) {
                    if (data.status === "success" && data.data.length > 0) {
                        page(i);
                        $("#page_p").on("click", function () {
                            i--;
                            if (i >= 0) {
                                page(i);
                            } else {
                                confirm("已无上一页");
                            }
                        });
                        $("#page_l").on("click", function () {
                            i++;
                            if (i <= data.data.length - 1) {
                                page(i);
                            } else {
                                confirm("已无下一页");
                            }
                        });

                        function page(i) {
                            $("#messageID").val(data.data[i].id);
                            $("#message").val(data.data[i].message);
                            $("#questionID").val(data.data[i].questionid);
                            $("#problem").val(data.data[i].problem);
                            $("#progress").val(data.data[i].progress);
                        }

                        $("#watch_word").show();
                        $("#car_information").hide();
                        $("#user_information").hide();
                        $("#updateUserPassword").hide();
                    } else {
                        alert("无留言");
                    }
                },
                error: function () {
                    alert("暂无留言！");
                }
            });
        });
        // 将用户选择的图片展示给用户
        $("#img").change(function () {
            var file = this.files[0];
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function (e) {
                $("#userImg").attr("src", e.target.result);
            };
        });
        $("#CarImg").change(function () {
            var file = this.files[0];
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function (e) {
                $("#Car_Img").attr("src", e.target.result);
            };
        });
        //修改用户密码
        $("#updatePassword").on("click", function () {
            $("#updateUserPassword").show();
            $("#watch_word").hide();
            $("#car_information").hide();
            $("#user_information").hide();
        });
        $("#updateToPassword").on("click", function () {
            if ($("#password1").val() === $("#password2").val()) {
                var upData = new FormData();
                upData.append("name", name);
                upData.append("secret", $("#secret").val());
                upData.append("password", $("#password1").val());
                $.ajax({
                    type: "POST",
                    contentType: false,
                    cache: false,
                    processData: false,
                    dataType: "json",
                    url: "http://localhost:8083/user/updateByUserSecret",
                    data: upData,
                    xhrFields: {withCredentials: true},
                    success: function (data) {
                        if (data.status === "success") {
                            alert("修改成功！");
                            window.location.href = "personal.html";
                        } else {
                            alert("修改失败！");
                        }
                    },
                    error: function (data) {
                        alert("修改失败:" + data.responseText);
                    }
                });
            } else {
                alert("两次所输入的密码不一致，请重新输入。")
            }
        });
        //删除用户帖子
        $("#delete").on("click", function () {
            var upData = new FormData();
            upData.append("id", ID);
            $.ajax({
                type: "POST",
                contentType: false,
                cache: false,
                processData: false,
                dataType: "json",
                url: "http://localhost:8083/car/deleteByPrimaryKey",
                data: upData,
                xhrFields: {withCredentials: true},
                success: function (data) {
                    if (data.status === "success") {
                        alert("删除成功");
                        window.location.href = "personal.html";
                    }
                },
                error: function (data) {
                    alert(data.responseText);
                }
            });
        });
        //回复问题解决的进度
        $("#btn_submit").on("click", function () {
            if ($("#progress").val() === "完成") {
                confirm("问题已经解决");
            } else {
                var upData = new FormData();
                upData.append("ID", $("#messageID").val());
                upData.append("select", $("#select").select().val());
                $.ajax({
                    type: "GET",
                    contentType: false,
                    cache: false,
                    processData: false,
                    dataType: "json",
                    url: "http://localhost:8083/word/update",
                    data: upData,
                    xhrFields: {withCredentials: true},
                    success: function (data) {
                        if (data.status === "success") {
                            confirm("回复成功");
                        }
                    },
                    error: function (data) {
                        confirm(data.responseText);
                    }
                });
            }
        });
    });
</script>
</html>
<!--// var dom = "<div class='right_information'>" +-->
<!--//     "<div class='showImg'>" +-->
<!--//     "<img id='Car_Img' src='../picture/car/User_Car/" + data.data[i].vehicle + "'>" +-->
<!--//     "<div class='showA'>" +-->
<!--//     "<a href='car.html'>增添</a>" +-->
<!--//     "<a href='http://localhost:8083/car/deleteByPrimaryKey?id=" + data.data[i].id + " '>删除</a>" +-->
<!--//     "</div>" +-->
<!--//     "</div>" +-->
<!--//     "<table class='Car_information'>" +-->
<!--//     "<tr><td><input type='text' name='id' id='id' size='40' placeholder='id' value='" + data.data[i].id + "' style='display: none;'></td></tr>" +-->
<!--//     "<tr><td><input type='text' name='name' id='name' size='40' placeholder='车名：" + data.data[i].name + "'></td></tr>" +-->
<!--//     "<tr><td><input type='text' name='power' id='power' size='40' placeholder='马力：" + data.data[i].power + "匹'></td></tr>" +-->
<!--//     "<tr><td><input type='text' name='price' id='price' size='40' placeholder='价格：" + data.data[i].price + "'></td></tr>" +-->
<!--//     "<tr><td><input type='text' name='date' id='date' size='40' placeholder='日期：" + date + "'></td></tr>" +-->
<!--//     "<tr><td><input type='text' name='description' id='description' size='40' placeholder='描述：" + data.data[i].description + "'></td></tr>" +-->
<!--//     "<tr><td><input type='file' name='img' id='CarImg' size='40' accept='image/png,image/jpg,image/jpeg' style='clip:rect(0,0,0,0);'></td></tr>" +-->
<!--//     "<tr><td><input id='Submit' style='margin-top: 10px;' type='submit' value='修改'></td></tr>" +-->
<!--//     "</table>" +-->
<!--//     "</div>";-->
<!--// $("#car_information").append(dom);-->